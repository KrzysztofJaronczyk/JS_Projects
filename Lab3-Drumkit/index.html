<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <audio src="./sounds/clap.wav" controls id="s1"></audio>
    <audio src="./sounds/hihat.wav" controls id="s2"></audio>
    <audio src="./sounds/kick.wav" controls id="s3"></audio>
    <audio src="./sounds/openhat.wav" controls id="s4"></audio>
    <audio src="./sounds/boom.wav" controls id="s5"></audio>
    <audio src="./sounds/ride.wav" controls id="s6"></audio>
    <audio src="./sounds/snare.wav" controls id="s7"></audio>
    <audio src="./sounds/tom.wav" controls id="s8"></audio>
    <audio src="./sounds/tink.wav" controls id="s9"></audio>

    <div class="play-all" id="play-all">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z">
            </path>
        </svg>
        <p>Zagraj zaznaczone kanały</p>
    </div>

    <div class="canals" id="canals">
        <div class="canal" id="1">
            <svg id="record-btn1" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn1" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal1">
        </div>
        <div class="canal" id="2">
            <svg id="record-btn2" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn2" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal2">
        </div>
        <div class="canal" id="3">
            <svg id="record-btn3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal3">
        </div>
        <div class="canal" id="4">
            <svg id="record-btn4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal4">
        </div>

    </div>

    <div class="inputs">
        <button type="button" id="addFieldButton">Dodaj kolejny kanał</button>
        <button type="button" id="reset">Reset strony</button>
    </div>
    <div id="result"></div>

    <script>
        const KeyToSound = {
            'a': document.querySelector('#s1'),
            's': document.querySelector('#s2'),
            'd': document.querySelector('#s3'),
            'f': document.querySelector('#s4'),
            'g': document.querySelector('#s5'),
            'h': document.querySelector('#s6'),
            'j': document.querySelector('#s7'),
            'k': document.querySelector('#s8'),
            'l': document.querySelector('#s9')
        }

        // Create an array to store recording data for each channel
        const recordingData = [];

        // Recording and Playback
        let isRecording = false;
        let isPlaying = false;

        document.addEventListener('keypress', function (e) {
            if (isRecording) {
                recordChannelData(e.key, Date.now());
                console.log(recordingData);
            }
            playSound(e.key);
        });

        function playSound(key) {
            const audioTag = KeyToSound[key];
            if (audioTag) {
                audioTag.currentTime = 0;
                audioTag.play();
            }
        }

        // Record and Playback Buttons
        const recordBtns = document.querySelectorAll('.canal svg[id^="record-btn"]');
        const playBtns = document.querySelectorAll('.canal svg[id^="play-btn"]');

        recordBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                if (isRecording) {
                    stopRecording();
                    btn.style.fill = 'none';
                } else {
                    startRecording(index);
                    btn.style.fill = 'red';
                }
            });
        });

        playBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                if (!isPlaying && recordingData[index].length > 0) {
                    stopRecording();
                    recordBtns[index].style.fill = 'none';
                    startPlayback(index);
                    btn.style.fill = 'green';
                    setTimeout(() => {
                        btn.style.fill = 'none';
                    }, recordingData[index][recordingData[index].length - 1][1] - recordingData[index][0][1] + 500);
                }

            });
        });

        function startRecording(channelIndex) {
            isRecording = true;
            isPlaying = false; // Stop playback if it's in progress
            recordingData[channelIndex] = []; // Clear previous recording
        }

        function stopRecording() {
            isRecording = false;
        }

        function recordChannelData(key, timestamp) {
            recordingData.forEach((channel, index) => {
                if (isRecording && index === recordingData.length - 1) {
                    channel.push([key, timestamp]);
                }
            });
        }

        function startPlayback(channelIndex) {
            if (recordingData[channelIndex] && recordingData[channelIndex].length > 0) {
                let startTime = recordingData[channelIndex][0][1];
                recordingData[channelIndex].forEach((sound) => {
                    const delay = sound[1] - startTime;
                    setTimeout(() => {
                        playSound(sound[0]);
                    }, delay);
                });
            }
        }
    </script>




    <script src="expandCanals.js"></script>
</body>

</html>