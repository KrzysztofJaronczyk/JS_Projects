<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <audio src="./sounds/clap.wav" controls id="s1"></audio>
    <audio src="./sounds/hihat.wav" controls id="s2"></audio>
    <audio src="./sounds/kick.wav" controls id="s3"></audio>
    <audio src="./sounds/openhat.wav" controls id="s4"></audio>
    <audio src="./sounds/boom.wav" controls id="s5"></audio>
    <audio src="./sounds/ride.wav" controls id="s6"></audio>
    <audio src="./sounds/snare.wav" controls id="s7"></audio>
    <audio src="./sounds/tom.wav" controls id="s8"></audio>
    <audio src="./sounds/tink.wav" controls id="s9"></audio>
    <img class="metronome" id="metronome" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAACS0lEQVR4nO2YQUsbQRTH50u0JNJTD1419QsoiaAnTx4Fr62YfhyTcy9+h1w0QQTtyR489FCwFCrEQOmhRYSfbDsbx9mZOBMzs7NtfpDDhLc777/73n8eK8Sc/xBgATiRv7qoIsBr4DMPfAEWRZUAVoBrinwH3ogqAKwCP7DzE1gXKQNsAb94mt/AtkgRYBe4w50sdkekBjDEn2uRoM1OS02kAtCUSQ3k+g+GuPH/WaxcNkUqAG2ZVMdDSFcu90UqKEm1TUL0WjKJTwK9TByFtOSyHzKxt8BLj/gbmVTdo7Tqcnkz4/THm72TG3zKxAB7QGNCfCEhFyGmBzBTZPKZCJR56WhCfEt1LNfSiuJc/BWjD32rlti8abtTCOmoJhGyvFR6Lo7lWVphnQtoZOWkCflmMgClPFpTCHl0kIYeyXtSxNgAtJiR3rAepRXWuXSAF8CF3PRSsdl8xhpp8U5CNOeqiRhobpZb85qpNFxLq7SZi+KbeQV80JvVU0jBLMp6M1mdLz+jtMqbuWw9oyfuKKRwoJbxZm7VntETN1xjEhLXuQxJ1bQHrbqZs5BSnEtFOcwuDG526FpatkM1GmqT2tzMQ0i3FOfSBr73NjczXGMT0tYHz2hYZiwvN4s+c5lQGnSWjETJjhWCQQwheSmEpB9DSN6cIWgHF2BwrBB0YgrpE55zn09SKTmWibOqO9YS8BE4rbpjNYMJiORYRPtCH9ixcg5izliVPwyHEYQM/5U3chxciBTzVdn0KrX7OQNsys2vgI3U7jdHlMg9Z+Kw83ki8GcAAAAASUVORK5CYII=">
        <div class="play-all" id="play-selected">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z">
            </path>
        </svg>
        <p>Play selected</p>
    </div>
    <div class="play-all" id="play-all">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z">
            </path>
        </svg>
        <p>Play all</p>
    </div>

    <div class="canals" id="canals">
        <div class="canal" id="1">
            <svg id="record-btn1" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn1" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal1">
        </div>
        <div class="canal" id="2">
            <svg id="record-btn2" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn2" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal2">
        </div>
        <div class="canal" id="3">
            <svg id="record-btn3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn3" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal3">
        </div>
        <div class="canal" id="4">
            <svg id="record-btn4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z">
                </path>
            </svg>
            <svg id="play-btn4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.91 11.672a.375.375 0 010 .656l-5.603 3.113a.375.375 0 01-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112z">
                </path>
            </svg>
            <input type="checkbox" id="canal4">
        </div>

    </div>

    <div class="inputs">
        <button type="button" id="addFieldButton">Add channel</button>
        <button type="button" id="reset">Reset</button>
    </div>
    <div id="result"></div>

    <script>
        const KeyToSound = {
            'a': document.querySelector('#s1'),
            's': document.querySelector('#s2'),
            'd': document.querySelector('#s3'),
            'f': document.querySelector('#s4'),
            'g': document.querySelector('#s5'),
            'h': document.querySelector('#s6'),
            'j': document.querySelector('#s7'),
            'k': document.querySelector('#s8'),
            'l': document.querySelector('#s9')
        }
    
        // Create an array to store recording data for each channel
        const recordingData = [];
    
        // Create an array to store selected channels
        const selectedChannels = [];
    
        // Recording and Playback
        let isRecording = false;
        let isPlaying = false;
    
        document.addEventListener('keypress', function (e) {
            if (isRecording) {
                recordChannelData(e.key, Date.now());
                console.log(recordingData);
            }
            playSound(e.key);
        });
    
        function playSound(key) {
            const audioTag = KeyToSound[key];
            if (audioTag) {
                audioTag.currentTime = 0;
                audioTag.play();
            }
        }
    
        // Record and Playback Buttons
        const recordBtns = document.querySelectorAll('.canal svg[id^="record-btn"]');
        const playBtns = document.querySelectorAll('.canal svg[id^="play-btn"]');
    
        recordBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                if (isRecording) {
                    stopRecording();
                    btn.style.fill = 'none';
                } else {
                    startRecording(index);
                    btn.style.fill = 'red';
                }
            });
        });
    
        playBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                if (!isPlaying && recordingData[index].length > 0) {
                    startPlayback(index);
                    btn.style.fill = 'green';
                }
            });
        });
    
        function startRecording(channelIndex) {
            isRecording = true;
            isPlaying = false; // Stop playback if it's in progress
            recordingData[channelIndex] = []; // Clear previous recording
        }
    
        function stopRecording() {
            isRecording = false;
        }
    
        function recordChannelData(key, timestamp) {
            recordingData.forEach((channel, index) => {
                if (isRecording && index === recordingData.length - 1) {
                    channel.push([key, timestamp]);
                }
            });
        }
    
        function startPlayback(channelIndex) {
            if (recordingData[channelIndex] && recordingData[channelIndex].length > 0) {
                let startTime = recordingData[channelIndex][0][1];
                recordingData[channelIndex].forEach((sound) => {
                    const delay = sound[1] - startTime;
                    setTimeout(() => {
                        playSound(sound[0]);
                    }, delay);
                });
            }
        }
    
        // Play Selected Channels Button
        const playSelectedButton = document.getElementById('play-selected');
        playSelectedButton.addEventListener('click', () => {
            console.log(selectedChannels);
            // Play all selected channels
            selectedChannels.forEach((channelIndex) => {
                startPlayback(channelIndex);
                playBtns[channelIndex].style.fill = 'green';
            });
        });
    
        // Play All Channels Button
        const playAllButton = document.getElementById('play-all');
        playAllButton.addEventListener('click', () => {
            // Play all channels
            playBtns.forEach((btn, index) => {
                if (recordingData[index].length > 0) {
                    startPlayback(index);
                    btn.style.fill = 'green';
                }
            });
        });
    
        // Checkbox event listeners to track selected channels
        const checkboxes = document.querySelectorAll('.canal input[type="checkbox"]');
        checkboxes.forEach((checkbox, index) => {
            checkbox.addEventListener('change', (event) => {
                if (event.target.checked) {
                    selectedChannels.push(index);
                } else {
                    const selectedIndex = selectedChannels.indexOf(index);
                    if (selectedIndex > -1) {
                        selectedChannels.splice(selectedIndex, 1);
                    }
                }
            });
        });
    </script>




    <script src="expandCanals.js"></script>
</body>

</html>